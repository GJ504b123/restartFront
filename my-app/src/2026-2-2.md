# ğŸ“… GJ504b çš„ React è¿›é˜¶ä¹‹è·¯ï¼šDay 2


## ä¸€ã€useEffect åŸºç¡€è®¤çŸ¥ï¼šè§£å†³â€œå‰¯ä½œç”¨â€é—®é¢˜
### 1. æ ¸å¿ƒä½œç”¨
`useEffect` ä¸“é—¨å¤„ç† React ç»„ä»¶ä¸­**éæ¸²æŸ“é€»è¾‘**çš„â€œå‰¯ä½œç”¨â€ï¼Œåœ¨ä»£ç ä¸­å®æˆ˜äº† 3 ç±»æ ¸å¿ƒå‰¯ä½œç”¨ï¼Œå¯¹åº”ä»£ç å¦‚ä¸‹ï¼š
```jsx
// 1. DOM æ“ä½œï¼ˆCounter ç»„ä»¶ï¼‰â€”â€” æ‰“å° DOM å…ƒç´ å†…å®¹
export default function Counter() {
  const [count, setCount] = useState(0);
  // ğŸ‘‡ å‰¯ä½œç”¨ï¼šæ“ä½œ DOM å…ƒç´ 
  useEffect(() =>{
      console.log(document.querySelector('.count')?.innerText)
  },[count])
  // ...å…¶ä½™ä»£ç 
}

// 2. ç½‘ç»œè¯·æ±‚ï¼ˆColorGet ç»„ä»¶ï¼‰â€”â€” fetch æ¥å£è·å–é¢œè‰²
export default function ColorGet(){
  const [color,setColor] = useState('')
  const [flag,setFlag] = useState(false)
  // ğŸ‘‡ å‰¯ä½œç”¨ï¼šç½‘ç»œè¯·æ±‚
  useEffect(()=>{
      const controller = new AbortController()
      if (!flag) return
      fetch('https://api.liulongbin.top/v1/color',{signal:controller.signal})
      // ...è¯·æ±‚å¤„ç†é€»è¾‘
  },[flag])
  // ...å…¶ä½™ä»£ç 
}

// 3. å®šæ—¶å™¨ï¼ˆPatientTable ç»„ä»¶ï¼‰â€”â€” setTimeout æ¨¡æ‹Ÿå¼‚æ­¥è¯·æ±‚
export default function PatientTable(){
    const[list,setList] = useState([]);
    // ğŸ‘‡ å‰¯ä½œç”¨ï¼šå®šæ—¶å™¨
    useEffect(() =>{
        const timer = setTimeout(() =>{
            const mockPatient = [/* æ¨¡æ‹Ÿæ•°æ® */];
            setList(mockPatient)
        },1000);
        // æ¸…ç†å‡½æ•°
        return () => clearTimeout(timer);
    },[]);
    // ...å…¶ä½™ä»£ç 
}
```

### 2. åŸºç¡€è¯­æ³•
```jsx

useEffect(() => {
  // ã€å‰¯ä½œç”¨å‡½æ•°ã€‘ï¼šæ‰§è¡Œç½‘ç»œè¯·æ±‚ï¼ˆæ ¸å¿ƒé€»è¾‘ï¼‰
  const controller = new AbortController()
  if (!flag) return
  fetch('https://api.liulongbin.top/v1/color',{signal:controller.signal})
  .then((res) =>res.json())
  .then((res) =>{
      console.log(res)
      setColor(res.data.color)
  })
  .catch((err)=>console.log("æ¶ˆæ¯ï¼š" + err.message))
  
  // ã€æ¸…ç†å‡½æ•°ã€‘ï¼šä¸­æ­¢æœªå®Œæˆçš„è¯·æ±‚ï¼Œé¿å…å†…å­˜æ³„æ¼
  return () => controller.abort()
}, [flag]); // ä¾èµ–é¡¹æ•°ç»„
```

## äºŒã€æ ¸å¿ƒè§„åˆ™ï¼šä¾èµ–é¡¹æ•°ç»„çš„â€œä¼˜å…ˆçº§â€
```jsx
useEffect(() =>{
    console.log(document.querySelector('.count')?.innerText)
},[])//1. ç©ºæ•°ç»„çš„ä½ç½®æ˜¯ä¾èµ–é¡¹ï¼Œåªä¼šæ‰§è¡Œ1æ¬¡

useEffect(() =>{
    console.log(document.querySelector('.count')?.innerText)
})//2. ä½†æ˜¯å¦‚æœä¸å†™ä¾èµ–é¡¹å°±ä»£è¡¨æ¯æ¬¡ç»„ä»¶æ¸²æŸ“åå†æ‰§è¡Œ

useEffect(() =>{
    console.log(document.querySelector('.count')?.innerText)
},[count])//3. åªåœ¨ç»„ä»¶æ¸²æŸ“å’Œåˆ¤æ–­countæ˜¯å¦æ”¹å˜åå†æ‰§è¡Œ

```

### é¿å‘ç‚¹
```jsx
export default function Counter() {
  const [count, setCount] = useState(0);
  // âŒ ç¦æ­¢ï¼šuseEffect å†…ä¿®æ”¹è‡ªèº«ä¾èµ–é¡¹ï¼ˆä¼šæ— é™å¾ªç¯ï¼‰
  // æ³¨é‡Š4ï¼šä»¥ä¸‹ä»£ç ä¼šå¯¼è‡´æ— é™å¾ªç¯
  // useEffect(() =>{
  //     setCount((prev) =>prev + 1)
  //     console.log(document.querySelector('.count')?.innerText)
  // },[count])

  // âœ… è§„èŒƒï¼šå¤šä¸ªå‰¯ä½œç”¨åˆ†å¼€å£°æ˜ï¼ˆæ³¨é‡Š5ï¼‰
  // æ¯”å¦‚â€œDOM ç›‘å¬â€å’Œâ€œç½‘ç»œè¯·æ±‚â€åˆ†å¼€å†™
  useEffect(() => { /* DOM æ“ä½œ */ }, [count]);
  useEffect(() => { /* è‹¥æœ‰è¯·æ±‚ */ }, []);
}
```

### è¡¥å……ï¼šReact ä¸¥æ ¼æ¨¡å¼çš„å½±å“
```jsx
export default function Counter() {
  const [count, setCount] = useState(0);
  // ğŸ‘† ç»„ä»¶é¡¶å±‚ä»£ç ï¼šå¼€å‘ç¯å¢ƒä¸¥æ ¼æ¨¡å¼ä¸‹ä¼šæ‰§è¡Œ 2 æ¬¡ï¼ˆæ¯”å¦‚ç›´æ¥å†™ console.log ä¼šæ‰“å°ä¸¤æ¬¡ï¼‰
  
  useEffect(() =>{
      console.log(document.querySelector('.count')?.innerText)
  },[count])
  // ğŸ‘† useEffect å†…ä»£ç ï¼šReact ç‰¹æ®Šå¤„ç†ï¼Œä»…æ‰§è¡Œ 1 æ¬¡ï¼ˆåˆå§‹æ¸²æŸ“æ—¶ï¼‰
}
```

## ä¸‰ã€è¿›é˜¶ç”¨æ³•ï¼šæ¸…ç†å‡½æ•°ï¼ˆreturn å‡½æ•°ï¼‰

```jsx
// ColorGet ç»„ä»¶ä¸­æ¸…ç†å‡½æ•°çš„è§¦å‘æ—¶æœºæ³¨é‡Š
useEffect(()=>{
    const controller = new AbortController()
    if (!flag) return
    fetch('https://api.liulongbin.top/v1/color',{signal:controller.signal})
    // ...è¯·æ±‚é€»è¾‘
    
    /* æ¸…ç†å‡½æ•°çš„è§¦å‘æ—¶æœºï¼š
    1. ç»„ä»¶è¢«å¸è½½æ—¶
    2. effectå‰¯ä½œç”¨å‡½æ•°è¢«æ‰§è¡Œä¹‹å‰ï¼Œå…ˆæ‰§è¡Œæ¸…ç†å‡½æ•° */
    return () => controller.abort()
},[flag])
```



## å››ã€å®æˆ˜è½åœ°ï¼šuseEffect ç»“åˆä¸šåŠ¡é€»è¾‘
### 1. ColorGet ç»„ä»¶ï¼šæ¡ä»¶è§¦å‘ç½‘ç»œè¯·æ±‚
```jsx
export default function ColorGet(){
  const [color,setColor] = useState('')
  const [flag,setFlag] = useState(false)
  // ğŸ‘‡ æ ¸å¿ƒï¼šä»… flag ä¸º true æ—¶å‘èµ·è¯·æ±‚
  useEffect(()=>{
      const controller = new AbortController()
      if (!flag) return // æ¡ä»¶åˆ¤æ–­ï¼šflag ä¸º false ç›´æ¥ç»ˆæ­¢
      fetch('https://api.liulongbin.top/v1/color',{signal:controller.signal})
      .then((res) =>res.json())
      .then((res) =>{
          console.log(res)
          setColor(res.data.color)
      })
      .catch((err)=>console.log("æ¶ˆæ¯ï¼š" + err.message))
      return () => controller.abort()
  },[flag]) // ä¾èµ– flagï¼Œç‚¹å‡»æŒ‰é’®ï¼ˆflag å˜åŒ–ï¼‰æ—¶æ‰§è¡Œ
  
  return(
      <>
          <button onClick={()=>setFlag((prev) => !prev)}>Click it</button>
          {flag && <p>color çš„é¢œè‰²æ˜¯ï¼š{color}</p>}
      </>
  )
}
```

![alt text](https://img2024.cnblogs.com/blog/3492455/202602/3492455-20260202230243302-862550579.png)

![alt text](https://img2024.cnblogs.com/blog/3492455/202602/3492455-20260202230243869-1592679197.png)

### 2. PatientTable ç»„ä»¶ï¼šæŒ‚è½½æ—¶æ¨¡æ‹Ÿå¼‚æ­¥è¯·æ±‚
```jsx
export default function PatientTable(){
    const[list,setList] = useState([]);
    // ğŸ‘‡ ä¾èµ–ç©ºæ•°ç»„ï¼šä»…æŒ‚è½½æ—¶æ‰§è¡Œ 1 æ¬¡
    useEffect(() =>{
        const timer = setTimeout(() =>{
            const mockPatient = [
                {name:'å¼ ä¸‰',state:'å·²ä¸Šé“¾',age:18},
                {name:'æå››',state:'æœªä¸Šé“¾',age:33},
                {name:'ç‹äº”',state:'å·²ä¸Šé“¾',age:16}
            ];
            setList(mockPatient)
            console.log('æ•°æ®åˆ°äº†ï¼')
        },1000);
        // æ¸…ç†å‡½æ•°ï¼šé¿å…ç»„ä»¶å¸è½½åå®šæ—¶å™¨æ‰§è¡Œ
        return () => clearTimeout(timer);
    },[]);
    
    // äº¤äº’ä¼˜åŒ–ï¼šåŠ è½½ä¸­/æ•°æ®å±•ç¤º
    return (
        <div>
            <h3>æœ€è¿‘è®¿é—®è€…</h3>
            {
                list.length ===0 ?<p>æ­£åœ¨è°ƒå–æ•°æ®</p> : (
                    <ul>{/* æ¸²æŸ“åˆ—è¡¨ */}</ul>
                )
            }
        </div>
    )
}
```
![alt text](https://img2024.cnblogs.com/blog/3492455/202602/3492455-20260202230244136-1948817940.png)

![alt text](https://img2024.cnblogs.com/blog/3492455/202602/3492455-20260202230244429-176693836.png)
### 3. Counter ç»„ä»¶ï¼šç›‘å¬çŠ¶æ€å˜åŒ–æ“ä½œ DOM
```jsx
export default function Counter() {
  const [count, setCount] = useState(0);
  function add() {
    setCount((count) =>count + 1);
  }
  // âŒ ç›´æ¥é¡¶å±‚æ“ä½œ DOMï¼šæ— æ³•å®æ—¶æ›´æ–°
  // console.log(document.querySelector('.count')?.innerText)
  
  // âœ… useEffect æ“ä½œ DOMï¼šç¡®ä¿æ‹¿åˆ°æœ€æ–° DOM
  useEffect(() =>{
      console.log(document.querySelector('.count')?.innerText)
  },[count])

  return (
    <div>
      <div className="count">count çš„å€¼ï¼š{count}</div>
      <button onClick={add}> + 1 </button>
    </div>
  );
}
```
![alt text](https://img2024.cnblogs.com/blog/3492455/202602/3492455-20260202230244689-1122962666.png)
### æ ¸å¿ƒè¦ç‚¹å›é¡¾
1. `useEffect` æ ¸å¿ƒæ˜¯å¤„ç†å‰¯ä½œç”¨ï¼ˆDOM/è¯·æ±‚/å®šæ—¶å™¨ï¼‰ï¼Œä¾èµ–é¡¹æ•°ç»„å†³å®šæ‰§è¡Œæ—¶æœºï¼šæ— ä¾èµ–=æ¯æ¬¡æ¸²æŸ“ã€ç©ºæ•°ç»„=ä»…æŒ‚è½½ã€ç‰¹å®šçŠ¶æ€=çŠ¶æ€å˜åŒ–æ—¶æ‰§è¡Œï¼›
2. æ¸…ç†å‡½æ•°æ˜¯â€œå†…å­˜ä¿æŠ¤æ‰‹æ®µâ€ï¼šå®šæ—¶å™¨è¦ `clearTimeout`ã€ç½‘ç»œè¯·æ±‚è¦ `abort`ï¼Œé¿å…å†…å­˜æ³„æ¼ï¼›
3. å®æˆ˜æŠ€å·§ï¼šé€šè¿‡ `if (!flag) return` æ¡ä»¶åˆ¤æ–­æ§åˆ¶å‰¯ä½œç”¨æ‰§è¡Œæ—¶æœºï¼Œè´´åˆä¸šåŠ¡é€»è¾‘ï¼›
4. ä¸¥æ ¼æ¨¡å¼ç‰¹æ€§ï¼šç»„ä»¶é¡¶å±‚ä»£ç æ‰§è¡Œ 2 æ¬¡ï¼Œ`useEffect` å†…ä»£ç ä»…æ‰§è¡Œ 1 æ¬¡ï¼ˆå¼€å‘ç¯å¢ƒï¼‰ã€‚









## åŠ›æ‰£
### é¢˜ç›®æè¿°
![alt text](https://img2024.cnblogs.com/blog/3492455/202602/3492455-20260202230245191-687212018.png)
### è§£é¢˜ï¼ˆæƒ³ä¸å‡ºæ¥ï¼Œæœ€åçœ‹çš„é¢˜è§£ï¼‰
è¿˜æ˜¯jså†…ç½®æ–¹æ³•ä¸å¤Ÿçµæ´»åº”ç”¨
```javascript
/**
 * @param {string[]} strs
 * @return {string[][]}
 */
var groupAnagrams = function(strs) {
    const n = strs.length;
    const map = new Map();
    for(let i = 0;i<n;i++){
        let arr = Array.from(strs[i]);//æŠŠå­—ç¬¦ä¸²å˜æˆå­—ç¬¦æ•°ç»„,ä¾¿äºåç»­æ’åºç­‰æ“ä½œ
        arr.sort();
        let key = arr.toString()//å°†æ’å¥½åºçš„å­—ç¬¦æ•°ç»„è½¬æˆå­—ç¬¦ä¸²ä½œä¸ºå“ˆå¸Œè¡¨çš„é”®
        let list = map.get(key) ?map.get(key):new Array();//å°†é”®å­˜å…¥åˆ†ç»„æ•°ç»„listï¼ˆæœ‰è¿™ä¸ªé”®å°±ç›´æ¥å­˜æ”¾ï¼Œæ²¡æœ‰å°±å¼€è¾Ÿæ–°æ•°ç»„ç©ºé—´å­˜æ”¾ï¼‰ï¼Œç›¸å½“ä¸â€œæŒ‡é’ˆâ€
        list.push(strs[i]);//æŠŠä¸æŒ‡é’ˆå¯¹åº”çš„å€¼ï¼ˆåŸå§‹å€¼ï¼‰å­˜å…¥å¯¹åº”æ•°ç»„
        map.set(key,list);//æŠŠæ›´æ–°åçš„listæ•°ç»„å’Œé”®æ”¾åœ¨mapå“ˆå¸Œè¡¨ä¸­
    }
    return Array.from(map.values());//è¿”å›æƒ³è¦çš„å€¼éƒ¨åˆ†
};

```
